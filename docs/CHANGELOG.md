# Changelog - Umbra Bot Framework\n\nAll notable changes to the Umbra project will be documented in this file.\n\nThe format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),\nand this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).\n\n## [Unreleased]\n\n### Planned\n- Business Module (BUS1): Multi-instance management\n- Enhanced Analytics: Advanced Parquet reporting\n- Mobile App: React Native companion\n- API Gateway: REST API for external integrations\n- Workflow Engine: Visual automation builder\n\n## [4.2.0] - 2025-01-21\n\n### üöÄ **F4R2 - Cloudflare R2 Object Storage** (Major Release)\n\n#### Added\n- **R2Client**: S3-compatible Cloudflare R2 integration with optimized boto3 configuration\n- **ObjectStorage**: High-level object operations with SHA256 verification and presigned URLs\n- **ManifestManager**: JSONL/Parquet manifest files with ETag-based optimistic locking\n- **SearchIndex**: Built-in text search with inverted index for documents and merchants\n- **Content-Addressed Storage**: SHA256-based document naming for deduplication\n- **Automatic Retry Logic**: Exponential backoff for network resilience\n- **Multi-format Support**: JSONL for real-time data, Parquet for analytics (with CSV fallback)\n- **Comprehensive Testing**: 95%+ test coverage with integration tests\n- **Documentation**: Complete F4R2_README.md with examples and troubleshooting\n- **Demo Scripts**: Interactive demonstration and validation tools\n- **GitHub Workflows**: Automated testing and security scanning\n\n#### Storage Features\n- Secure presigned URL generation with configurable expiration\n- Automatic content type detection based on file extensions\n- Metadata support with custom key-value pairs\n- Efficient object listing with prefix filtering and pagination\n- Storage statistics and monitoring capabilities\n\n#### Manifest Features\n- **JSONL Manifests**: Append-only data streams with timestamp and unique IDs\n- **Parquet Manifests**: Columnar storage with monthly partitioning\n- **Concurrency Control**: ETag-based optimistic locking with automatic retries\n- **Schema Validation**: Optional type checking for Parquet data\n- **Partition Management**: Automatic and manual partition creation/listing\n\n#### Search Features\n- **Multi-language Support**: Text normalization for German, French, and English\n- **Keyword Search**: AND/OR operators with partial matching\n- **Merchant Search**: Fuzzy matching for business names\n- **Stop Word Filtering**: Configurable stop words for better relevance\n- **Index Statistics**: Performance monitoring and optimization insights\n\n#### Configuration\n- Environment-based R2 configuration with validation\n- Automatic endpoint generation from account ID\n- Graceful degradation when R2 is unavailable\n- Feature flags for optional components\n\n#### Developer Experience\n- Type hints throughout the codebase\n- Comprehensive error handling with specific exception types\n- Extensive logging for debugging and monitoring\n- Performance optimization for large datasets\n- Memory-efficient streaming for large files\n\n### Changed\n- **requirements.txt**: Organized dependencies by category, added F4R2 requirements\n- **Project Structure**: New `umbra.storage` package for F4R2 components\n- **Documentation**: Updated main README with F4R2 integration examples\n- **.gitignore**: Added F4R2-specific exclusions for test artifacts\n\n### Technical Details\n- **Dependencies**: Added boto3, botocore, pyarrow (optional)\n- **Python Support**: Compatible with Python 3.9-3.12\n- **Memory Usage**: Optimized for large file handling with streaming\n- **Network**: Configurable timeouts and retry policies\n- **Security**: No credentials stored in logs, secure presigned URLs\n\n## [4.1.0] - 2025-01-15\n\n### üß† **F3R1 - AI Integration** (Major Release)\n\n#### Added\n- **OpenRouter Integration**: Access to 200+ AI models through unified API\n- **Multi-Role AI System**: Specialized agents (Planner, Builder, Controller, Chat)\n- **Streaming Support**: Real-time AI responses with token-by-token delivery\n- **Conversation History**: Context-aware responses with message threading\n- **Model Selection**: Per-role model configuration with fallbacks\n- **Usage Tracking**: Token consumption and cost monitoring\n- **Error Handling**: Robust retry logic with exponential backoff\n- **Rate Limiting**: Built-in protection against API abuse\n\n#### AI Features\n- **Planner Agent**: Task analysis and step-by-step planning\n- **Builder Agent**: Code generation and technical implementations\n- **Controller Agent**: System control and automation\n- **Chat Agent**: Natural conversations with context awareness\n\n#### Configuration\n- Environment-based API key management\n- Model preferences with automatic fallbacks\n- Timeout and retry configuration\n- Usage limits and monitoring\n\n### Changed\n- Enhanced `/chat` command with AI integration\n- Improved error messages with AI context\n- Added AI status to `/status` command\n\n### Technical Details\n- **Dependencies**: Added openai, httpx for AI integration\n- **Architecture**: Modular AI client with role-based routing\n- **Performance**: Async/await throughout for better concurrency\n- **Security**: API keys never logged or exposed\n\n## [4.0.0] - 2025-01-10\n\n### üèóÔ∏è **Core Framework Rewrite** (Breaking Changes)\n\n#### Added\n- **Modular Architecture**: Plugin-based module system\n- **Swiss Accountant**: Expense tracking and financial management\n- **Creator Module**: Content generation and brand management\n- **Concierge Module**: Virtual assistant capabilities\n- **Production Module**: Automated workflows and integrations\n- **Railway Deployment**: One-click cloud deployment support\n- **Configuration Management**: Environment-based settings with validation\n- **User Management**: Multi-user support with role-based permissions\n- **System Monitoring**: Health checks and performance metrics\n\n#### Framework Features\n- **BaseModule**: Abstract base class for all modules\n- **Command Router**: Automatic command registration and routing\n- **Middleware Support**: Request/response preprocessing\n- **Error Handling**: Centralized exception management\n- **Logging**: Structured logging with configurable levels\n\n#### Swiss Accountant\n- Expense entry with categories and descriptions\n- Receipt processing (text and image)\n- Budget tracking and alerts\n- Financial reporting and exports\n- Multi-currency support\n\n#### Creator Module\n- Brand voice management\n- Content templates and generation\n- Asset organization and storage\n- Collaborative content creation\n\n### Changed\n- **Breaking**: Complete rewrite of bot framework\n- **Breaking**: New command structure and syntax\n- **Breaking**: Database schema changes\n- **Architecture**: Move from monolithic to modular design\n- **Deployment**: Railway-first deployment strategy\n\n### Removed\n- Legacy single-file bot implementation\n- Hardcoded command handlers\n- SQLite direct access (replaced with ORM)\n\n### Technical Details\n- **Python**: Upgraded to support 3.9-3.12\n- **Framework**: python-telegram-bot 20.7\n- **Database**: aiosqlite with async/await\n- **Configuration**: python-dotenv for environment management\n- **Monitoring**: psutil for system metrics\n\n## [3.0.0] - 2024-12-15\n\n### üîÑ **Legacy System** (End of Life)\n\n#### Features (Historical)\n- Basic Telegram bot functionality\n- Simple command handling\n- SQLite data storage\n- Single-user operation\n- Manual deployment\n\n#### Limitations\n- Monolithic architecture\n- No module system\n- Limited scalability\n- Manual configuration\n- No AI integration\n- No cloud storage\n\n---\n\n## Version Numbering\n\n- **Major (X.0.0)**: Breaking changes, architectural overhauls\n- **Minor (X.Y.0)**: New features, modules, significant enhancements\n- **Patch (X.Y.Z)**: Bug fixes, small improvements, security updates\n\n## Feature Codes\n\n- **F3R1**: AI Integration (OpenRouter)\n- **F4R2**: Object Storage (Cloudflare R2)\n- **BUS1**: Business Module (Planned)\n- **CRT3**: Creator Module v3 (Planned)\n- **FNC1**: Finance Module v1 (Planned)\n\n## Migration Guides\n\n### Upgrading to 4.2.0 (F4R2)\n\n1. **Install Dependencies**:\n   ```bash\n   pip install -r requirements.txt\n   ```\n\n2. **Configure R2 (Optional)**:\n   ```bash\n   # Add to .env\n   R2_ACCOUNT_ID=your_account_id\n   R2_ACCESS_KEY_ID=your_access_key\n   R2_SECRET_ACCESS_KEY=your_secret_key\n   R2_BUCKET=your_bucket_name\n   ```\n\n3. **Validate Setup**:\n   ```bash\n   python f4r2_validate.py\n   ```\n\n4. **Update Code** (if using storage):\n   ```python\n   # Old (if any)\n   # Direct file operations\n   \n   # New F4R2\n   from umbra.storage import ObjectStorage, ManifestManager\n   storage = ObjectStorage()\n   manifests = ManifestManager(storage)\n   ```\n\n### Upgrading to 4.1.0 (F3R1)\n\n1. **Configure OpenRouter**:\n   ```bash\n   # Add to .env\n   OPENROUTER_API_KEY=your_api_key\n   ```\n\n2. **Update Commands**:\n   ```python\n   # Old\n   /help\n   \n   # New\n   /chat How can I improve my expenses?\n   /plan Create a budget tracking system\n   ```\n\n### Breaking Changes from 3.x to 4.x\n\n- **Commands**: All commands restructured\n- **Database**: Schema completely changed\n- **Configuration**: Environment variables required\n- **Deployment**: Railway deployment recommended\n- **Architecture**: Modular system requires code updates\n\n## Support\n\n- **Documentation**: See README.md and feature-specific docs\n- **Issues**: Use GitHub Issues for bug reports\n- **Features**: Use GitHub Discussions for feature requests\n- **Security**: Email security issues privately\n\n---\n\n**Built with Swiss precision for global scale. üá®üá≠**\n"